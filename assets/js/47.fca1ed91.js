(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{247:function(e,t,r){"use strict";r.r(t);var _=r(0),s=Object(_.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"tcp原理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#tcp原理"}},[e._v("#")]),e._v(" TCP原理")]),e._v(" "),r("ans",[r("p",[r("a",{attrs:{href:"https://juejin.im/post/5e527c58e51d4526c654bf41?utm_source=gold_browser_extension",target:"_blank",rel:"noopener noreferrer"}},[e._v("详细解析"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("TCP(Transmission Control Protocol)传输控制协议")]),e._v(" "),r("p",[e._v("TCP是主机对主机层的传输控制协议，提供可靠的连接服务，采用三次握手确认建立一个连接：")]),e._v(" "),r("p",[e._v("位码即tcp标志位，有6种标示：SYN(synchronous建立联机) ACK(acknowledgement 确认) PSH(push传送) FIN(finish结束) RST(reset重置) URG(urgent紧急)Sequence number(顺序号码) Acknowledge number(确认号码)")]),e._v(" "),r("h4",{attrs:{id:"三次握手"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#三次握手"}},[e._v("#")]),e._v(" 三次握手")]),e._v(" "),r("blockquote",[r("p",[e._v("对应到 TCP 的三次握手，也是需要确认双方的两样能力: "),r("code",[e._v("发送的能力")]),e._v("和"),r("code",[e._v("接收的能力")]),e._v("。于是便会有下面的三次握手的过程:")])]),e._v(" "),r("p",[r("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/2/23/170723de9b8aa08b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"img"}})]),e._v(" "),r("p",[e._v("第三次握手可以携带数据")]),e._v(" "),r("h4",{attrs:{id:"四次挥手"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#四次挥手"}},[e._v("#")]),e._v(" 四次挥手")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/2/23/170723e5c0e05829?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"img"}})]),e._v(" "),r("p",[e._v("当客户端收到服务端发来的"),r("code",[e._v("FIN")]),e._v("后，自己变成了"),r("code",[e._v("TIME-WAIT")]),e._v("状态，然后发送 ACK 给服务端。")]),e._v(" "),r("p",[e._v("注意了，这个时候，客户端需要等待足够长的时间，具体来说，是 2 个 "),r("code",[e._v("MSL")]),e._v("("),r("code",[e._v("Maximum Segment Lifetime，报文最大生存时间")]),e._v("), 在这段时间内如果客户端没有收到服务端的重发请求，那么表示 ACK 成功到达，挥手结束，否则客户端重发 ACK。")]),e._v(" "),r("h4",{attrs:{id:"等待2msl的意义"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#等待2msl的意义"}},[e._v("#")]),e._v(" 等待2MSL的意义")]),e._v(" "),r("p",[e._v("如果不等待会怎样？")]),e._v(" "),r("p",[e._v("如果不等待，客户端直接跑路，当服务端还有很多数据包要给客户端发，且还在路上的时候，若客户端的端口此时刚好被新的应用占用，那么就接收到了无用数据包，造成数据包混乱。所以，最保险的做法是等服务器发来的数据包都死翘翘再启动新的应用。")]),e._v(" "),r("p",[e._v("那，照这样说一个 MSL 不就不够了吗，为什么要等待 2 MSL?")]),e._v(" "),r("ul",[r("li",[e._v("1 个 MSL 确保四次挥手中主动关闭方最后的 ACK 报文最终能达到对端")]),e._v(" "),r("li",[e._v("1 个 MSL 确保对端没有收到 ACK 重传的 FIN 报文可以到达")])]),e._v(" "),r("p",[e._v("这就是等待 2MSL 的意义。")])])],1)}),[],!1,null,null,null);t.default=s.exports}}]);